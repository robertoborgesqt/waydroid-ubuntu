#!/bin/bash

# Verifica se um nome de container foi fornecido
if [ -z "$1" ]; then
  echo "Uso: $0 <nome_do_container>"
  exit 1
fi

CONTAINER="$1"

# Verifica o estado do container
STATUS=$(sudo lxc info "$CONTAINER" | grep -i "Status" | awk '{print $2}')

if [ "$STATUS" != "Running" ]; then
  echo "O container '$CONTAINER' não está em execução. Iniciando..."
  sudo lxc start "$CONTAINER"
  sleep 5 # Dá um tempo para o container ser totalmente iniciado
else
  echo "O container '$CONTAINER' já está em execução."
fi

# Executa o comando dentro do container para verificar o estado do Waydroid
echo "Verificando se o Waydroid está inicializado dentro do container '$CONTAINER'..."
WAYDROID_STATUS=$(sudo lxc exec "$CONTAINER" -- bash -c "systemctl is-active waydroid-container" 2>/dev/null)

if [ "$WAYDROID_STATUS" != "active" ]; then
  echo "O Waydroid não está inicializado. Inicializando..."
  sudo lxc exec "$CONTAINER" -- bash -c "sudo waydroid init"
  sudo lxc exec "$CONTAINER" -- bash -c "sudo systemctl start waydroid-container"
else
  echo "O Waydroid já está inicializado."
fi

# Inicia a sessão do Waydroid
echo "Iniciando uma sessão no Waydroid..."
sudo lxc exec "$CONTAINER" -- bash -c "waydroid session start"

# Exibe a interface gráfica do Waydroid
echo "Abrindo a interface gráfica do Waydroid..."
sudo lxc exec "$CONTAINER" -- bash -c "waydroid show-full-ui"


